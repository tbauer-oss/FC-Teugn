datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

enum Role {
  TRAINER_ADMIN
  TRAINER
  PARENT
}

enum AccountStatus {
  PENDING
  APPROVED
  BLOCKED
}

enum EventType {
  TRAINING
  MATCH
  EVENT
}

enum AttendanceStatus {
  YES
  NO
  MAYBE
  UNKNOWN
}

model Team {
  id        String   @id @default(cuid())
  name      String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  users     User[]
  players   Player[]
  events    Event[]
  squads    Squad[]
}

model User {
  id        String        @id @default(cuid())
  email     String        @unique
  password  String
  name      String
  phone     String?
  role      Role          @default(PARENT)
  status    AccountStatus @default(PENDING)
  teamId    String
  createdAt DateTime      @default(now())
  updatedAt DateTime      @updatedAt
  team      Team          @relation(fields: [teamId], references: [id])
  parentLinks ParentPlayerLink[] @relation("ParentLinks")
}

model Player {
  id          String   @id @default(cuid())
  teamId      String
  firstName   String
  lastName    String
  birthDate   DateTime?
  position    String?
  shirtNumber Int?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  team        Team     @relation(fields: [teamId], references: [id])
  parentLinks ParentPlayerLink[]
  attendance  Attendance[]
  squadMembers SquadMember[]
}

model ParentPlayerLink {
  id        String   @id @default(cuid())
  parentId  String
  playerId  String
  createdAt DateTime @default(now())
  parent    User     @relation("ParentLinks", fields: [parentId], references: [id])
  player    Player   @relation(fields: [playerId], references: [id])

  @@unique([parentId, playerId])
}

model Event {
  id                   String    @id @default(cuid())
  teamId               String
  type                 EventType
  title                String
  startAt              DateTime
  endAt                DateTime?
  location             String
  description          String?
  attendanceFinalized  Boolean   @default(false)
  createdAt            DateTime  @default(now())
  updatedAt            DateTime  @updatedAt
  team                 Team      @relation(fields: [teamId], references: [id])
  attendance           Attendance[]
  matchDetails         MatchDetails?
  squads               Squad[]
}

model MatchDetails {
  id          String   @id @default(cuid())
  eventId     String   @unique
  opponent    String
  isHome      Boolean  @default(true)
  competition String?
  notes       String?
  ourGoals    Int?
  theirGoals  Int?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  event       Event    @relation(fields: [eventId], references: [id])
}

model Attendance {
  id        String           @id @default(cuid())
  eventId   String
  playerId  String
  status    AttendanceStatus @default(UNKNOWN)
  updatedAt DateTime         @updatedAt
  event     Event            @relation(fields: [eventId], references: [id])
  player    Player           @relation(fields: [playerId], references: [id])

  @@unique([eventId, playerId])
}

model Squad {
  id        String   @id @default(cuid())
  eventId   String
  name      String?
  formation String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  event     Event    @relation(fields: [eventId], references: [id])
  members   SquadMember[]
}

model SquadMember {
  id        String   @id @default(cuid())
  squadId   String
  playerId  String
  createdAt DateTime @default(now())
  squad     Squad    @relation(fields: [squadId], references: [id])
  player    Player   @relation(fields: [playerId], references: [id])

  @@unique([squadId, playerId])
}
